<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gyroscope Demo – Inverse Tilt</title>
  <style>
    /* ---------- Global layout ---------- */
    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
      background: #111;
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      perspective: 800px; /* depth for 3‑D rotations */
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
    }

    /* ---------- Text zone (center) ---------- */
    #content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      pointer-events: none;
    }

    #tiltingText {
      font-size: clamp(2.2rem, 9vw, 6rem);
      font-weight: 700;
      transform-style: preserve-3d;
      transform: rotateX(0deg) rotateY(0deg);
      transition: transform 0.05s linear;
    }

    #staticText {
      font-size: clamp(1rem, 4vw, 2rem);
      color: #888;
      margin-top: 0.5rem;
    }

    /* ---------- Stats (bottom) ---------- */
    #stats {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      font-family: monospace;
      line-height: 1.4;
    }

    #values {
      color: #0f0;
      font-size: 1.2rem;
    }

    #status {
      margin-top: 0.25rem;
      font-size: 0.75rem;
      color: #888;
    }
  </style>
</head>
<body>
  <div id="content">
    <span id="tiltingText">Always&nbsp;Flat</span>
    <span id="staticText">This text never tilts</span>
  </div>

  <div id="stats">
    <div id="values">α: -- °/s<br>β: -- °/s<br>γ: -- °/s</div>
    <div id="status">Initializing…</div>
  </div>

  <script>
    (function () {
      const tiltingEl = document.getElementById("tiltingText");
      const valuesEl  = document.getElementById("values");
      const statusEl  = document.getElementById("status");

      /*
       * -------------------------------------------------------------
       *  Orientation handling – make text appear vertical when phone
       *  is flat (screen up) and neutral when phone is upright.
       * -------------------------------------------------------------
       *
       *  ‣ e.beta  : front‑to‑back tilt  (‑180 → 180). Approximately  0 when
       *              the phone lies flat screen‑up, +90 when upright.
       *  ‣ We want:
       *        phone flat   (β≈0)   → text rotated +90° about X (vertical)
       *        phone upright(β≈90)  → text 0° about X (no rotation)
       *  ‣ Formula:   adjustedX = 90 − β
       */
      function onOrientation(e) {
        let beta  = e.beta  ?? 0; // front/back tilt
        let gamma = e.gamma ?? 0; // left/right tilt

        // Clamp gamma so text doesn’t skew too far sideways
        gamma = Math.max(Math.min(gamma, 60), -60);

        const adjustedX = 90 - beta; // core inverse‑tilt magic ✨

        tiltingEl.style.transform = `rotateX(${adjustedX}deg) rotateY(${gamma}deg)`;
      }

      /* ---------------- Gyroscope stats ---------------- */
      function onMotion(e) {
        const r = e.rotationRate || {};
        const a = r.alpha != null ? r.alpha.toFixed(1) : "--";
        const b = r.beta  != null ? r.beta .toFixed(1) : "--";
        const g = r.gamma != null ? r.gamma.toFixed(1) : "--";
        valuesEl.innerHTML = `α: ${a} °/s<br>β: ${b} °/s<br>γ: ${g} °/s`;
      }

      /* ---------------- Permissions / setup ---------------- */
      function initSensors() {
        window.addEventListener("deviceorientation", onOrientation, true);
        window.addEventListener("devicemotion", onMotion, true);
        statusEl.textContent = "Listening to sensors…";
      }

      function requestMotionPermissionIfNeeded(cb) {
        if (
          typeof DeviceMotionEvent !== "undefined" &&
          typeof DeviceMotionEvent.requestPermission === "function"
        ) {
          DeviceMotionEvent.requestPermission()
            .then((state) => {
              if (state === "granted") cb();
              else statusEl.textContent = "Motion permission denied.";
            })
            .catch(() => (statusEl.textContent = "Motion permission error."));
        } else {
          cb();
        }
      }

      function setup() {
        if (!("DeviceMotionEvent" in window)) {
          statusEl.textContent = "DeviceMotionEvent not supported.";
          return;
        }
        requestMotionPermissionIfNeeded(initSensors);
      }

      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
      if (isIOS) {
        statusEl.textContent = "Tap to enable motion sensors ✋";
        window.addEventListener("click", setup, { once: true });
      } else {
        setup();
      }
    })();
  </script>
</body>
</html>
