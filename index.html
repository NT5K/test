<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gyroscope AR Text Demo v2</title>
    <style>
      /* ========== Global Layout ========== */
      html,
      body {
        height: 100%;
        margin: 0;
        display: flex;
        flex-direction: column;
        background: #111;
        color: #fff;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        perspective: 1000px; /* depth for 3‑D rotations */
        -webkit-font-smoothing: antialiased;
        text-rendering: geometricPrecision;
      }

      /* ========== Scene ========== */
      #content {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        pointer-events: none;
      }

      #tiltingText {
        font-size: clamp(2.2rem, 9vw, 6rem);
        font-weight: 700;
        transform-style: preserve-3d;
        transform-origin: bottom center; /* hinge on the bezel */
        transform: rotateX(0deg) rotateY(0deg) translateZ(0px);
        transition: transform 0.05s linear;
        /* depth cue */
        text-shadow: 0 2px 8px rgba(0, 255, 255, 0.4);
      }

      #staticText {
        font-size: clamp(1rem, 4vw, 2rem);
        color: #888;
        margin-top: 0.5rem;
      }

      /* ========== Stats ========== */
      #stats {
        position: fixed;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        font-family: monospace;
        line-height: 1.4;
      }

      #values {
        color: #0f0;
        font-size: 1.2rem;
      }

      #status {
        margin-top: 0.25rem;
        font-size: 0.75rem;
        color: #888;
      }
    </style>
  </head>
  <body>
    <div id="content">
      <span id="tiltingText">Always Flat</span>
      <span id="staticText">Reference (static)</span>
    </div>

    <div id="stats">
      <div id="values">α: -- °/s<br />β: -- °/s<br />γ: -- °/s</div>
      <div id="status">Initializing…</div>
    </div>

    <script>
      (function () {
        const tiltingEl = document.getElementById("tiltingText");
        const valuesEl = document.getElementById("values");
        const statusEl = document.getElementById("status");

        /*
         * =============================================================
         *  Orientation logic – keep stretching toward the viewer.
         *
         *  β (front/back tilt) ranges roughly:
         *     −180   …   0   …   90  …  180  degrees
         *    top‑toward  flat     upright
         *
         *  We map text rotationX = −β so:
         *     • β  0°   → rotX 0°   (flat)
         *     • β 90°  → rotX −90° (edge‑on)
         *     • β ‑90° → rotX 90°  (full face as phone leans toward viewer)
         *
         *  In other words, no clamping: the text keeps “stretching” in the
         *  same direction beyond upright, producing a continuous AR feel.
         * =============================================================
         */
        function onOrientation(e) {
          const beta = e.beta ?? 0;   // front/back tilt (‑180 → 180)
          const gamma = e.gamma ?? 0; // left/right tilt  (‑90  → 90)

          // Primary rotation – flip sign so tilt toward viewer is positive
          let rotX = -beta;

          // Clamp extremes to avoid gimbal madness but keep wide range
          rotX = Math.max(Math.min(rotX, 120), -120);

          // Sideways lean, scaled down for readability
          let rotY = -gamma * 0.6;
          rotY = Math.max(Math.min(rotY, 60), -60);

          const zLift = 20; // px – slight pop‑out for depth
          tiltingEl.style.transform = `translateZ(${zLift}px) rotateX(${rotX}deg) rotateY(${rotY}deg)`;
        }

        /* ========== Gyroscope stats ========== */
        function onMotion(e) {
          const r = e.rotationRate || {};
          const a = r.alpha != null ? r.alpha.toFixed(1) : "--";
          const b = r.beta  != null ? r.beta .toFixed(1) : "--";
          const g = r.gamma != null ? r.gamma.toFixed(1) : "--";
          valuesEl.innerHTML = `α: ${a} °/s<br>β: ${b} °/s<br>γ: ${g} °/s`;
        }

        /* ========== Permissions & setup ========== */
        function initSensors() {
          window.addEventListener("deviceorientation", onOrientation, true);
          window.addEventListener("devicemotion", onMotion, true);
          statusEl.textContent = "Listening to sensors…";
        }

        function requestMotionPermissionIfNeeded(cb) {
          if (
            typeof DeviceMotionEvent !== "undefined" &&
            typeof DeviceMotionEvent.requestPermission === "function"
          ) {
            DeviceMotionEvent.requestPermission()
              .then((state) => {
                if (state === "granted") cb();
                else statusEl.textContent = "Motion permission denied.";
              })
              .catch(() => (statusEl.textContent = "Motion permission error."));
          } else {
            cb();
          }
        }

        function setup() {
          if (!("DeviceMotionEvent" in window)) {
            statusEl.textContent = "DeviceMotionEvent not supported.";
            return;
          }
          requestMotionPermissionIfNeeded(initSensors);
        }

        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (isIOS) {
          statusEl.textContent = "Tap to enable motion sensors ✋";
          window.addEventListener("click", setup, { once: true });
        } else {
          setup();
        }
      })();
    </script>
  </body>
</html>
