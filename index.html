<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gyroscope AR Text Demo</title>
    <style>
      /* ====== Layout ====== */
      html,
      body {
        height: 100%;
        margin: 0;
        display: flex;
        flex-direction: column;
        background: #111;
        color: #fff;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        perspective: 1000px; /* stronger depth for AR feeling */
        -webkit-font-smoothing: antialiased;
        text-rendering: geometricPrecision;
      }

      /* ====== Scene ====== */
      #content {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        pointer-events: none;
      }

      #tiltingText {
        font-size: clamp(2.2rem, 9vw, 6rem);
        font-weight: 700;
        transform-style: preserve-3d;
        transform-origin: bottom center; /* pivot from phone edge */
        transform: rotateX(0deg) rotateY(0deg) translateZ(0px);
        transition: transform 0.05s linear;
        /* subtle glow for depth */
        text-shadow: 0 2px 8px rgba(0, 255, 255, 0.4);
      }

      #staticText {
        font-size: clamp(1rem, 4vw, 2rem);
        color: #888;
        margin-top: 0.5rem;
      }

      /* ====== Stats ====== */
      #stats {
        position: fixed;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        font-family: monospace;
        line-height: 1.4;
      }

      #values {
        color: #0f0;
        font-size: 1.2rem;
      }

      #status {
        margin-top: 0.25rem;
        font-size: 0.75rem;
        color: #888;
      }
    </style>
  </head>
  <body>
    <div id="content">
      <span id="tiltingText">Always Flat</span>
      <span id="staticText">Reference (static)</span>
    </div>

    <div id="stats">
      <div id="values">α: -- °/s<br />β: -- °/s<br />γ: -- °/s</div>
      <div id="status">Initializing…</div>
    </div>

    <script>
      (function () {
        const tiltingEl = document.getElementById("tiltingText");
        const valuesEl = document.getElementById("values");
        const statusEl = document.getElementById("status");

        /*
         * =============================================
         *  Orientation → make text behave like a sign
         *  standing on the bottom edge of the screen.
         *
         *  β (front/back tilt):
         *    ▸  0°  : phone flat  → text flat (fully visible from above)
         *    ▸ 90°  : phone vertical → text vertical edge-on (invisible)
         *    ▸ >90° : phone leaning toward viewer → text leans toward viewer
         *
         *  We therefore rotateX by -β.
         * =============================================
         */
        function onOrientation(e) {
          let beta = e.beta ?? 0;   // front/back tilt (‑180 → 180)
          let gamma = e.gamma ?? 0;  // left/right tilt (‑90 → 90)

          /*
           * We want the front face visible whenever the phone leans toward
           * the user (β ≤ 0) and gradually disappear only as the device
           * approaches vertical (β → 90°). If the phone continues past
           * vertical (β > 90°) or tips the opposite way (β < 0°), keep the
           * text fully visible (flat).
           */

          // Clamp β to [0, 90] so beyond this range the face stays flat
          const clampedBeta = Math.min(Math.max(beta, 0), 90);

          // Map: 0  → 0   (flat)
          //      90 → −90 (edge‑on)
          const rotX = -clampedBeta;

          // Natural sideways lean, scaled down
          const rotY = -gamma * 0.6;

          // Slight Z lift for depth
          const zLift = 20;

          tiltingEl.style.transform = `translateZ(${zLift}px) rotateX(${rotX}deg) rotateY(${rotY}deg)`;
        }

        /* ====== Gyro stats ====== */
        function onMotion(e) {
          const r = e.rotationRate || {};
          const a = r.alpha != null ? r.alpha.toFixed(1) : "--";
          const b = r.beta != null ? r.beta.toFixed(1) : "--";
          const g = r.gamma != null ? r.gamma.toFixed(1) : "--";
          valuesEl.innerHTML = `α: ${a} °/s<br>β: ${b} °/s<br>γ: ${g} °/s`;
        }

        /* ====== Permissions & setup ====== */
        function initSensors() {
          window.addEventListener("deviceorientation", onOrientation, true);
          window.addEventListener("devicemotion", onMotion, true);
          statusEl.textContent = "Listening to sensors…";
        }

        function requestMotionPermissionIfNeeded(cb) {
          if (
            typeof DeviceMotionEvent !== "undefined" &&
            typeof DeviceMotionEvent.requestPermission === "function"
          ) {
            DeviceMotionEvent.requestPermission()
              .then((state) => {
                if (state === "granted") cb();
                else statusEl.textContent = "Motion permission denied.";
              })
              .catch(() => (statusEl.textContent = "Motion permission error."));
          } else {
            cb();
          }
        }

        function setup() {
          if (!("DeviceMotionEvent" in window)) {
            statusEl.textContent = "DeviceMotionEvent not supported.";
            return;
          }
          requestMotionPermissionIfNeeded(initSensors);
        }

        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (isIOS) {
          statusEl.textContent = "Tap to enable motion sensors ✋";
          window.addEventListener("click", setup, { once: true });
        } else {
          setup();
        }
      })();
    </script>
  </body>
</html>
